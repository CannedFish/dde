// Generated by CoffeeScript 1.6.2
(function() {
  var DEEPIN_ITEM_ID, Loader, Weather, ajax, allname, assert, build_menu, calc_text_size, cities, clamp, create_element, create_img, dnd_is_deepin_item, dnd_is_desktop, dnd_is_file, echo, find_drag_target, get_function_name, get_page_xy, plugins, run_post, swap_element, weather, _,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  Storage.prototype.setObject = function(key, value) {
    return this.setItem(key, JSON.stringify(value));
  };

  Storage.prototype.getObject = function(key) {
    return JSON.parse(this.getItem(key));
  };

  String.prototype.endsWith = function(suffix) {
    return this.indexOf(suffix, this.length - suffix.length) !== -1;
  };

  Array.prototype.remove = function(el) {
    var i;

    i = this.indexOf(el);
    if (i !== -1) {
      return this.splice(this.indexOf(el), 1)[0];
    }
  };

  echo = function(log) {
    return console.log(log);
  };

  assert = function(value, msg) {
    if (!value) {
      throw new Error(msg);
    }
  };

  _ = function(s) {
    return DCore.gettext(s);
  };

  build_menu = function(info) {
    var i, m, sm, v, _i, _len;

    m = new DeepinMenu;
    for (_i = 0, _len = info.length; _i < _len; _i++) {
      v = info[_i];
      if (v.length === 0) {
        i = new DeepinMenuItem(2, 0, 0, 0);
      } else if (typeof v[0] === "number") {
        i = new DeepinMenuItem(0, v[0], v[1], null);
        if (v.length > 2 && v[2] === false) {
          i.enabled = false;
        } else {
          i.enabled = true;
        }
      } else {
        sm = build_menu(v[1]);
        i = new DeepinMenuItem(1, 0, v[0], sm);
      }
      m.appendItem(i);
    }
    return m;
  };

  get_page_xy = function(el, x, y) {
    var p;

    return p = webkitConvertPointFromNodeToPage(el, new WebKitPoint(x, y));
  };

  find_drag_target = function(el) {
    var p;

    p = el;
    if (p.draggable) {
      return p;
    }
    while (p = el.parentNode) {
      if (p.draggable) {
        return p;
      }
    }
    return null;
  };

  swap_element = function(c1, c2) {
    var tmp;

    if (c1.parentNode === c2.parentNode) {
      tmp = document.createElement('div');
      c1.parentNode.insertBefore(tmp, c1);
      c2.parentNode.insertBefore(c1, c2);
      tmp.parentNode.insertBefore(c2, tmp);
      return tmp.parentNode.removeChild(tmp);
    }
  };

  document.body.ondrop = function(e) {
    return e.preventDefault();
  };

  run_post = function(f, self) {
    var f2;

    f2 = f.bind(self || this);
    return setTimeout(f2, 0);
  };

  create_element = function(type, clss, parent) {
    var el;

    el = document.createElement(type);
    if (clss) {
      el.setAttribute("class", clss);
    }
    if (parent) {
      parent.appendChild(el);
    }
    return el;
  };

  create_img = function(clss, src, parent) {
    var el;

    el = create_element('img', clss, parent);
    el.src = src;
    el.draggable = false;
    return el;
  };

  calc_text_size = function(txt, width) {
    var h, tmp;

    tmp = create_element('div', 'hidden_calc_text', document.body);
    tmp.innerText = txt;
    tmp.style.width = "" + width + "px";
    h = tmp.clientHeight;
    document.body.removeChild(tmp);
    return h;
  };

  clamp = function(value, min, max) {
    if (value < min) {
      return min;
    }
    if (value > max) {
      return max;
    }
    return value;
  };

  get_function_name = function() {
    if (!arguments.caller) {
      return "AnymouseFunction";
    }
    return /function (.*?)\(/.exec(arguments.caller.toString())[1];
  };

  DEEPIN_ITEM_ID = "deepin-item-id";

  dnd_is_desktop = function(e) {
    return e.dataTransfer.getData("text/uri-list").trim().endsWith(".desktop");
  };

  dnd_is_deepin_item = function(e) {
    if (e.dataTransfer.getData(DEEPIN_ITEM_ID)) {
      return true;
    } else {
      return false;
    }
  };

  dnd_is_file = function(e) {
    return e.dataTransfer.getData("text/uri-list").length !== 0;
  };

  ajax = function(url, method, callback, asyn) {
    var xhr;

    if (asyn == null) {
      asyn = true;
    }
    xhr = new XMLHttpRequest();
    xhr.open(method, url, asyn);
    xhr.send(null);
    return xhr.onreadystatechange = function() {
      if (xhr.readyState === 4 && xhr.status === 200) {
        return typeof callback === "function" ? callback(xhr) : void 0;
      }
    };
  };

  Loader = (function() {
    function Loader() {
      this._loadsyncjs = __bind(this._loadsyncjs, this);      window.loader = new Object;
      this.loader = window.loader;
      this.syncjs = [];
      this.asyncjs = [];
      this.css = [];
      this.syncjs.has = this.asyncjs.has = this.css.has = function(f) {
        var i, _i, _len;

        for (_i = 0, _len = this.length; _i < _len; _i++) {
          i = this[_i];
          if (f === this[i].src) {
            return true;
          } else {
            return false;
          }
        }
      };
    }

    Loader.prototype.addjs = function(path, sync, callback, args) {
      var js;

      js = null;
      if (sync) {
        js = this.syncjs;
      } else {
        js = this.asyncjs;
      }
      if (!js.has(path)) {
        js.push({
          'src': path,
          'callback': callback,
          'args': args
        });
      }
      return this;
    };

    Loader.prototype.addcss = function(path) {
      if (!this.css.has(path)) {
        this.css.push({
          'src': path
        });
      }
      return this;
    };

    Loader.prototype.load = function() {
      this._loadcss();
      return this._loadsyncjs();
    };

    Loader.prototype._loadcss = function() {
      var ele, head, i, _i, _len, _ref;

      head = document.getElementsByTagName('head')[0];
      _ref = this.css;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        i = _ref[_i];
        ele = document.createElement('link');
        ele.type = 'text/css';
        ele.rel = 'stylesheet';
        ele.href = i.src;
        head.appendChild(ele);
      }
    };

    Loader.prototype._loadjs = function(object, parent, func) {
      var fs, js;

      fs = [];
      js = document.createElement('script');
      js.type = 'text/javascript';
      if (typeof object.callback === 'function') {
        fs.push(object.callback);
      }
      if (typeof func === 'function') {
        fs.push(func);
      }
      if (fs.length > 0) {
        this._onload(fs, object.args, js);
      }
      js.src = object.src;
      return parent.appendChild(js);
    };

    Loader.prototype._loadsyncjs = function() {
      var head, js;

      if (this.syncjs.length > 0) {
        head = document.getElementsByTagName('head')[0];
        js = this.syncjs.shift();
        return this._loadjs(js, head, this._loadsyncjs);
      } else {
        return this._loadasyncjs();
      }
    };

    Loader.prototype._loadasyncjs = function() {
      var head, i, _i, _len, _ref;

      head = document.getElementsByTagName('head')[0];
      _ref = this.asyncjs;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        i = _ref[_i];
        this._loadjs(asyncjs[i], head);
      }
      return this.asyncjs = [];
    };

    Loader.prototype._onload = function(func, arg, obj) {
      if (obj) {
        if (typeof func === 'function') {
          func = [func];
        }
        if (obj.readyState) {
          obj.onreadystatechange = function() {
            var f, _i, _len, _results;

            if (obj.readyState === 'loaded' || obj.readyState === 'complete') {
              obj.onreadystatechange === null;
              _results = [];
              for (_i = 0, _len = func.length; _i < _len; _i++) {
                f = func[_i];
                _results.push(f(arg));
              }
              return _results;
            }
          };
        } else {
          obj.onload = function() {
            var f, _i, _len, _results;

            _results = [];
            for (_i = 0, _len = func.length; _i < _len; _i++) {
              f = func[_i];
              _results.push(f(arg));
            }
            return _results;
          };
        }
      }
    };

    return Loader;

  })();

  cities = [
    {
      "id": "01",
      "name": "北京"
    }, {
      "id": "02",
      "name": "上海"
    }, {
      "id": "03",
      "name": "天津"
    }, {
      "id": "04",
      "name": "重庆"
    }, {
      "id": "05",
      "name": "黑龙江"
    }, {
      "id": "06",
      "name": "吉林"
    }, {
      "id": "07",
      "name": "辽宁"
    }, {
      "id": "08",
      "name": "内蒙古"
    }, {
      "id": "09",
      "name": "河北"
    }, {
      "id": "10",
      "name": "山西"
    }, {
      "id": "11",
      "name": "陕西"
    }, {
      "id": "12",
      "name": "山东"
    }, {
      "id": "13",
      "name": "新疆"
    }, {
      "id": "14",
      "name": "西藏"
    }, {
      "id": "15",
      "name": "青海"
    }, {
      "id": "16",
      "name": "甘肃"
    }, {
      "id": "17",
      "name": "宁夏"
    }, {
      "id": "18",
      "name": "河南"
    }, {
      "id": "19",
      "name": "江苏"
    }, {
      "id": "20",
      "name": "湖北"
    }, {
      "id": "21",
      "name": "浙江"
    }, {
      "id": "22",
      "name": "安徽"
    }, {
      "id": "23",
      "name": "福建"
    }, {
      "id": "24",
      "name": "江西"
    }, {
      "id": "25",
      "name": "湖南"
    }, {
      "id": "26",
      "name": "贵州"
    }, {
      "id": "27",
      "name": "四川"
    }, {
      "id": "28",
      "name": "广东"
    }, {
      "id": "29",
      "name": "云南"
    }, {
      "id": "30",
      "name": "广西"
    }, {
      "id": "31",
      "name": "海南"
    }, {
      "id": "32",
      "name": "香港"
    }, {
      "id": "33",
      "name": "澳门"
    }, {
      "id": "34",
      "name": "台湾"
    }
  ];

  allname = {
    "data": [
      {
        "省": "澳门",
        "市": [
          {
            "市名": "澳门",
            "编码": "101330101"
          }
        ]
      }, {
        "省": "香港",
        "市": [
          {
            "市名": "香港",
            "编码": "101320101"
          }
        ]
      }, {
        "省": "台湾",
        "市": [
          {
            "市名": "台北",
            "编码": "101340102"
          }, {
            "市名": "高雄",
            "编码": "101340201"
          }
        ]
      }, {
        "省": "北京",
        "市": [
          {
            "市名": "北京",
            "编码": "101010100"
          }, {
            "市名": "朝阳",
            "编码": "101010300"
          }, {
            "市名": "顺义",
            "编码": "101010400"
          }, {
            "市名": "怀柔",
            "编码": "101010500"
          }, {
            "市名": "通州",
            "编码": "101010600"
          }, {
            "市名": "昌平",
            "编码": "101010700"
          }, {
            "市名": "延庆",
            "编码": "101010800"
          }, {
            "市名": "丰台",
            "编码": "101010900"
          }, {
            "市名": "石景山",
            "编码": "101011000"
          }, {
            "市名": "大兴",
            "编码": "101011100"
          }, {
            "市名": "房山",
            "编码": "101011200"
          }, {
            "市名": "密云",
            "编码": "101011300"
          }, {
            "市名": "门头沟",
            "编码": "101011400"
          }, {
            "市名": "平谷",
            "编码": "101011500"
          }, {
            "市名": "八达岭",
            "编码": "101011600"
          }, {
            "市名": "佛爷顶",
            "编码": "101011700"
          }, {
            "市名": "汤河口",
            "编码": "101011800"
          }, {
            "市名": "密云上甸子",
            "编码": "101011900"
          }, {
            "市名": "斋堂",
            "编码": "101012000"
          }, {
            "市名": "霞云岭",
            "编码": "101012100"
          }, {
            "市名": "北京城区",
            "编码": "101012200"
          }, {
            "市名": "海淀",
            "编码": "101010200"
          }
        ]
      }, {
        "省": "天津",
        "市": [
          {
            "市名": "天津",
            "编码": "101030100"
          }, {
            "市名": "宝坻",
            "编码": "101030300"
          }, {
            "市名": "东丽",
            "编码": "101030400"
          }, {
            "市名": "西青",
            "编码": "101030500"
          }, {
            "市名": "北辰",
            "编码": "101030600"
          }, {
            "市名": "蓟县",
            "编码": "101031400"
          }, {
            "市名": "汉沽",
            "编码": "101030800"
          }, {
            "市名": "静海",
            "编码": "101030900"
          }, {
            "市名": "津南",
            "编码": "101031000"
          }, {
            "市名": "塘沽",
            "编码": "101031100"
          }, {
            "市名": "大港",
            "编码": "101031200"
          }, {
            "市名": "武清",
            "编码": "101030200"
          }, {
            "市名": "宁河",
            "编码": "101030700"
          }
        ]
      }, {
        "省": "上海",
        "市": [
          {
            "市名": "上海",
            "编码": "101020100"
          }, {
            "市名": "宝山",
            "编码": "101020300"
          }, {
            "市名": "嘉定",
            "编码": "101020500"
          }, {
            "市名": "南汇",
            "编码": "101020600"
          }, {
            "市名": "浦东",
            "编码": "101021300"
          }, {
            "市名": "青浦",
            "编码": "101020800"
          }, {
            "市名": "松江",
            "编码": "101020900"
          }, {
            "市名": "奉贤",
            "编码": "101021000"
          }, {
            "市名": "崇明",
            "编码": "101021100"
          }, {
            "市名": "徐家汇",
            "编码": "101021200"
          }, {
            "市名": "闵行",
            "编码": "101020200"
          }, {
            "市名": "金山",
            "编码": "101020700"
          }
        ]
      }, {
        "省": "河北",
        "市": [
          {
            "市名": "石家庄",
            "编码": "101090101"
          }, {
            "市名": "张家口",
            "编码": "101090301"
          }, {
            "市名": "承德",
            "编码": "101090402"
          }, {
            "市名": "唐山",
            "编码": "101090501"
          }, {
            "市名": "秦皇岛",
            "编码": "101091101"
          }, {
            "市名": "沧州",
            "编码": "101090701"
          }, {
            "市名": "衡水",
            "编码": "101090801"
          }, {
            "市名": "邢台",
            "编码": "101090901"
          }, {
            "市名": "邯郸",
            "编码": "101091001"
          }, {
            "市名": "保定",
            "编码": "101090201"
          }, {
            "市名": "廊坊",
            "编码": "101090601"
          }
        ]
      }, {
        "省": "河南",
        "市": [
          {
            "市名": "郑州",
            "编码": "101180101"
          }, {
            "市名": "新乡",
            "编码": "101180301"
          }, {
            "市名": "许昌",
            "编码": "101180401"
          }, {
            "市名": "平顶山",
            "编码": "101180501"
          }, {
            "市名": "信阳",
            "编码": "101180601"
          }, {
            "市名": "南阳",
            "编码": "101180701"
          }, {
            "市名": "开封",
            "编码": "101180801"
          }, {
            "市名": "洛阳",
            "编码": "101180901"
          }, {
            "市名": "商丘",
            "编码": "101181001"
          }, {
            "市名": "焦作",
            "编码": "101181101"
          }, {
            "市名": "鹤壁",
            "编码": "101181201"
          }, {
            "市名": "濮阳",
            "编码": "101181301"
          }, {
            "市名": "周口",
            "编码": "101181401"
          }, {
            "市名": "漯河",
            "编码": "101181501"
          }, {
            "市名": "驻马店",
            "编码": "101181601"
          }, {
            "市名": "三门峡",
            "编码": "101181701"
          }, {
            "市名": "济源",
            "编码": "101181801"
          }, {
            "市名": "安阳",
            "编码": "101180201"
          }
        ]
      }, {
        "省": "安徽",
        "市": [
          {
            "市名": "合肥",
            "编码": "101220101"
          }, {
            "市名": "芜湖",
            "编码": "101220301"
          }, {
            "市名": "淮南",
            "编码": "101220401"
          }, {
            "市名": "马鞍山",
            "编码": "101220501"
          }, {
            "市名": "安庆",
            "编码": "101220601"
          }, {
            "市名": "宿州",
            "编码": "101220701"
          }, {
            "市名": "阜阳",
            "编码": "101220801"
          }, {
            "市名": "亳州",
            "编码": "101220901"
          }, {
            "市名": "黄山",
            "编码": "101221001"
          }, {
            "市名": "滁州",
            "编码": "101221101"
          }, {
            "市名": "淮北",
            "编码": "101221201"
          }, {
            "市名": "铜陵",
            "编码": "101221301"
          }, {
            "市名": "宣城",
            "编码": "101221401"
          }, {
            "市名": "六安",
            "编码": "101221501"
          }, {
            "市名": "巢湖",
            "编码": "101221601"
          }, {
            "市名": "池州",
            "编码": "101221701"
          }, {
            "市名": "蚌埠",
            "编码": "101220201"
          }
        ]
      }, {
        "省": "浙江",
        "市": [
          {
            "市名": "杭州",
            "编码": "101210101"
          }, {
            "市名": "舟山",
            "编码": "101211101"
          }, {
            "市名": "湖州",
            "编码": "101210201"
          }, {
            "市名": "嘉兴",
            "编码": "101210301"
          }, {
            "市名": "金华",
            "编码": "101210901"
          }, {
            "市名": "绍兴",
            "编码": "101210501"
          }, {
            "市名": "台州",
            "编码": "101210601"
          }, {
            "市名": "温州",
            "编码": "101210701"
          }, {
            "市名": "丽水",
            "编码": "101210801"
          }, {
            "市名": "衢州",
            "编码": "101211001"
          }, {
            "市名": "宁波",
            "编码": "101210401"
          }
        ]
      }, {
        "省": "重庆",
        "市": [
          {
            "市名": "重庆",
            "编码": "101040100"
          }, {
            "市名": "合川",
            "编码": "101040300"
          }, {
            "市名": "南川",
            "编码": "101040400"
          }, {
            "市名": "江津",
            "编码": "101040500"
          }, {
            "市名": "万盛",
            "编码": "101040600"
          }, {
            "市名": "渝北",
            "编码": "101040700"
          }, {
            "市名": "北碚",
            "编码": "101040800"
          }, {
            "市名": "巴南",
            "编码": "101040900"
          }, {
            "市名": "长寿",
            "编码": "101041000"
          }, {
            "市名": "黔江",
            "编码": "101041100"
          }, {
            "市名": "万州天城",
            "编码": "101041200"
          }, {
            "市名": "万州龙宝",
            "编码": "101041300"
          }, {
            "市名": "涪陵",
            "编码": "101041400"
          }, {
            "市名": "开县",
            "编码": "101041500"
          }, {
            "市名": "城口",
            "编码": "101041600"
          }, {
            "市名": "云阳",
            "编码": "101041700"
          }, {
            "市名": "巫溪",
            "编码": "101041800"
          }, {
            "市名": "奉节",
            "编码": "101041900"
          }, {
            "市名": "巫山",
            "编码": "101042000"
          }, {
            "市名": "潼南",
            "编码": "101042100"
          }, {
            "市名": "垫江",
            "编码": "101042200"
          }, {
            "市名": "梁平",
            "编码": "101042300"
          }, {
            "市名": "忠县",
            "编码": "101042400"
          }, {
            "市名": "石柱",
            "编码": "101042500"
          }, {
            "市名": "大足",
            "编码": "101042600"
          }, {
            "市名": "荣昌",
            "编码": "101042700"
          }, {
            "市名": "铜梁",
            "编码": "101042800"
          }, {
            "市名": "璧山",
            "编码": "101042900"
          }, {
            "市名": "丰都",
            "编码": "101043000"
          }, {
            "市名": "武隆",
            "编码": "101043100"
          }, {
            "市名": "彭水",
            "编码": "101043200"
          }, {
            "市名": "綦江",
            "编码": "101043300"
          }, {
            "市名": "酉阳",
            "编码": "101043400"
          }, {
            "市名": "秀山",
            "编码": "101043600"
          }, {
            "市名": "沙坪坝",
            "编码": "101043700"
          }, {
            "市名": "永川",
            "编码": "101040200"
          }
        ]
      }, {
        "省": "福建",
        "市": [
          {
            "市名": "福州",
            "编码": "101230101"
          }, {
            "市名": "泉州",
            "编码": "101230501"
          }, {
            "市名": "漳州",
            "编码": "101230601"
          }, {
            "市名": "龙岩",
            "编码": "101230701"
          }, {
            "市名": "晋江",
            "编码": "101230509"
          }, {
            "市名": "南平",
            "编码": "101230901"
          }, {
            "市名": "厦门",
            "编码": "101230201"
          }, {
            "市名": "宁德",
            "编码": "101230301"
          }, {
            "市名": "莆田",
            "编码": "101230401"
          }, {
            "市名": "三明",
            "编码": "101230801"
          }
        ]
      }, {
        "省": "甘肃",
        "市": [
          {
            "市名": "兰州",
            "编码": "101160101"
          }, {
            "市名": "平凉",
            "编码": "101160301"
          }, {
            "市名": "庆阳",
            "编码": "101160401"
          }, {
            "市名": "武威",
            "编码": "101160501"
          }, {
            "市名": "金昌",
            "编码": "101160601"
          }, {
            "市名": "嘉峪关",
            "编码": "101161401"
          }, {
            "市名": "酒泉",
            "编码": "101160801"
          }, {
            "市名": "天水",
            "编码": "101160901"
          }, {
            "市名": "武都",
            "编码": "101161001"
          }, {
            "市名": "临夏",
            "编码": "101161101"
          }, {
            "市名": "合作",
            "编码": "101161201"
          }, {
            "市名": "白银",
            "编码": "101161301"
          }, {
            "市名": "定西",
            "编码": "101160201"
          }, {
            "市名": "张掖",
            "编码": "101160701"
          }
        ]
      }, {
        "省": "广东",
        "市": [
          {
            "市名": "广州",
            "编码": "101280101"
          }, {
            "市名": "惠州",
            "编码": "101280301"
          }, {
            "市名": "梅州",
            "编码": "101280401"
          }, {
            "市名": "汕头",
            "编码": "101280501"
          }, {
            "市名": "深圳",
            "编码": "101280601"
          }, {
            "市名": "珠海",
            "编码": "101280701"
          }, {
            "市名": "佛山",
            "编码": "101280800"
          }, {
            "市名": "肇庆",
            "编码": "101280901"
          }, {
            "市名": "湛江",
            "编码": "101281001"
          }, {
            "市名": "江门",
            "编码": "101281101"
          }, {
            "市名": "河源",
            "编码": "101281201"
          }, {
            "市名": "清远",
            "编码": "101281301"
          }, {
            "市名": "云浮",
            "编码": "101281401"
          }, {
            "市名": "潮州",
            "编码": "101281501"
          }, {
            "市名": "东莞",
            "编码": "101281601"
          }, {
            "市名": "中山",
            "编码": "101281701"
          }, {
            "市名": "阳江",
            "编码": "101281801"
          }, {
            "市名": "揭阳",
            "编码": "101281901"
          }, {
            "市名": "茂名",
            "编码": "101282001"
          }, {
            "市名": "汕尾",
            "编码": "101282101"
          }, {
            "市名": "韶关",
            "编码": "101280201"
          }
        ]
      }, {
        "省": "广西",
        "市": [
          {
            "市名": "南宁",
            "编码": "101300101"
          }, {
            "市名": "柳州",
            "编码": "101300301"
          }, {
            "市名": "来宾",
            "编码": "101300401"
          }, {
            "市名": "桂林",
            "编码": "101300501"
          }, {
            "市名": "梧州",
            "编码": "101300601"
          }, {
            "市名": "防城港",
            "编码": "101301401"
          }, {
            "市名": "贵港",
            "编码": "101300801"
          }, {
            "市名": "玉林",
            "编码": "101300901"
          }, {
            "市名": "百色",
            "编码": "101301001"
          }, {
            "市名": "钦州",
            "编码": "101301101"
          }, {
            "市名": "河池",
            "编码": "101301201"
          }, {
            "市名": "北海",
            "编码": "101301301"
          }, {
            "市名": "崇左",
            "编码": "101300201"
          }, {
            "市名": "贺州",
            "编码": "101300701"
          }
        ]
      }, {
        "省": "贵州",
        "市": [
          {
            "市名": "贵阳",
            "编码": "101260101"
          }, {
            "市名": "安顺",
            "编码": "101260301"
          }, {
            "市名": "都匀",
            "编码": "101260401"
          }, {
            "市名": "兴义",
            "编码": "101260906"
          }, {
            "市名": "铜仁",
            "编码": "101260601"
          }, {
            "市名": "毕节",
            "编码": "101260701"
          }, {
            "市名": "六盘水",
            "编码": "101260801"
          }, {
            "市名": "遵义",
            "编码": "101260201"
          }, {
            "市名": "凯里",
            "编码": "101260501"
          }
        ]
      }, {
        "省": "云南",
        "市": [
          {
            "市名": "昆明",
            "编码": "101290101"
          }, {
            "市名": "红河",
            "编码": "101290301"
          }, {
            "市名": "文山",
            "编码": "101290601"
          }, {
            "市名": "玉溪",
            "编码": "101290701"
          }, {
            "市名": "楚雄",
            "编码": "101290801"
          }, {
            "市名": "普洱",
            "编码": "101290901"
          }, {
            "市名": "昭通",
            "编码": "101291001"
          }, {
            "市名": "临沧",
            "编码": "101291101"
          }, {
            "市名": "怒江",
            "编码": "101291201"
          }, {
            "市名": "香格里拉",
            "编码": "101291301"
          }, {
            "市名": "丽江",
            "编码": "101291401"
          }, {
            "市名": "德宏",
            "编码": "101291501"
          }, {
            "市名": "景洪",
            "编码": "101291601"
          }, {
            "市名": "大理",
            "编码": "101290201"
          }, {
            "市名": "曲靖",
            "编码": "101290401"
          }, {
            "市名": "保山",
            "编码": "101290501"
          }
        ]
      }, {
        "省": "内蒙古",
        "市": [
          {
            "市名": "呼和浩特",
            "编码": "101080101"
          }, {
            "市名": "乌海",
            "编码": "101080301"
          }, {
            "市名": "集宁",
            "编码": "101080401"
          }, {
            "市名": "通辽",
            "编码": "101080501"
          }, {
            "市名": "阿拉善左旗",
            "编码": "101081201"
          }, {
            "市名": "鄂尔多斯",
            "编码": "101080701"
          }, {
            "市名": "临河",
            "编码": "101080801"
          }, {
            "市名": "锡林浩特",
            "编码": "101080901"
          }, {
            "市名": "呼伦贝尔",
            "编码": "101081000"
          }, {
            "市名": "乌兰浩特",
            "编码": "101081101"
          }, {
            "市名": "包头",
            "编码": "101080201"
          }, {
            "市名": "赤峰",
            "编码": "101080601"
          }
        ]
      }, {
        "省": "江西",
        "市": [
          {
            "市名": "南昌",
            "编码": "101240101"
          }, {
            "市名": "上饶",
            "编码": "101240301"
          }, {
            "市名": "抚州",
            "编码": "101240401"
          }, {
            "市名": "宜春",
            "编码": "101240501"
          }, {
            "市名": "鹰潭",
            "编码": "101241101"
          }, {
            "市名": "赣州",
            "编码": "101240701"
          }, {
            "市名": "景德镇",
            "编码": "101240801"
          }, {
            "市名": "萍乡",
            "编码": "101240901"
          }, {
            "市名": "新余",
            "编码": "101241001"
          }, {
            "市名": "九江",
            "编码": "101240201"
          }, {
            "市名": "吉安",
            "编码": "101240601"
          }
        ]
      }, {
        "省": "湖北",
        "市": [
          {
            "市名": "武汉",
            "编码": "101200101"
          }, {
            "市名": "黄冈",
            "编码": "101200501"
          }, {
            "市名": "荆州",
            "编码": "101200801"
          }, {
            "市名": "宜昌",
            "编码": "101200901"
          }, {
            "市名": "恩施",
            "编码": "101201001"
          }, {
            "市名": "十堰",
            "编码": "101201101"
          }, {
            "市名": "神农架",
            "编码": "101201201"
          }, {
            "市名": "随州",
            "编码": "101201301"
          }, {
            "市名": "荆门",
            "编码": "101201401"
          }, {
            "市名": "天门",
            "编码": "101201501"
          }, {
            "市名": "仙桃",
            "编码": "101201601"
          }, {
            "市名": "潜江",
            "编码": "101201701"
          }, {
            "市名": "襄樊",
            "编码": "101200201"
          }, {
            "市名": "鄂州",
            "编码": "101200301"
          }, {
            "市名": "孝感",
            "编码": "101200401"
          }, {
            "市名": "黄石",
            "编码": "101200601"
          }, {
            "市名": "咸宁",
            "编码": "101200701"
          }
        ]
      }, {
        "省": "四川",
        "市": [
          {
            "市名": "成都",
            "编码": "101270101"
          }, {
            "市名": "自贡",
            "编码": "101270301"
          }, {
            "市名": "绵阳",
            "编码": "101270401"
          }, {
            "市名": "南充",
            "编码": "101270501"
          }, {
            "市名": "达州",
            "编码": "101270601"
          }, {
            "市名": "遂宁",
            "编码": "101270701"
          }, {
            "市名": "广安",
            "编码": "101270801"
          }, {
            "市名": "巴中",
            "编码": "101270901"
          }, {
            "市名": "泸州",
            "编码": "101271001"
          }, {
            "市名": "宜宾",
            "编码": "101271101"
          }, {
            "市名": "内江",
            "编码": "101271201"
          }, {
            "市名": "资阳",
            "编码": "101271301"
          }, {
            "市名": "乐山",
            "编码": "101271401"
          }, {
            "市名": "眉山",
            "编码": "101271501"
          }, {
            "市名": "凉山",
            "编码": "101271601"
          }, {
            "市名": "雅安",
            "编码": "101271701"
          }, {
            "市名": "甘孜",
            "编码": "101271801"
          }, {
            "市名": "阿坝",
            "编码": "101271901"
          }, {
            "市名": "德阳",
            "编码": "101272001"
          }, {
            "市名": "广元",
            "编码": "101272101"
          }, {
            "市名": "攀枝花",
            "编码": "101270201"
          }
        ]
      }, {
        "省": "宁夏",
        "市": [
          {
            "市名": "银川",
            "编码": "101170101"
          }, {
            "市名": "中卫",
            "编码": "101170501"
          }, {
            "市名": "固原",
            "编码": "101170401"
          }, {
            "市名": "石嘴山",
            "编码": "101170201"
          }, {
            "市名": "吴忠",
            "编码": "101170301"
          }
        ]
      }, {
        "省": "青海省",
        "市": [
          {
            "市名": "西宁",
            "编码": "101150101"
          }, {
            "市名": "黄南",
            "编码": "101150301"
          }, {
            "市名": "海北",
            "编码": "101150801"
          }, {
            "市名": "果洛",
            "编码": "101150501"
          }, {
            "市名": "玉树",
            "编码": "101150601"
          }, {
            "市名": "海西",
            "编码": "101150701"
          }, {
            "市名": "海东",
            "编码": "101150201"
          }, {
            "市名": "海南",
            "编码": "101150401"
          }
        ]
      }, {
        "省": "山东",
        "市": [
          {
            "市名": "济南",
            "编码": "101120101"
          }, {
            "市名": "潍坊",
            "编码": "101120601"
          }, {
            "市名": "临沂",
            "编码": "101120901"
          }, {
            "市名": "菏泽",
            "编码": "101121001"
          }, {
            "市名": "滨州",
            "编码": "101121101"
          }, {
            "市名": "东营",
            "编码": "101121201"
          }, {
            "市名": "威海",
            "编码": "101121301"
          }, {
            "市名": "枣庄",
            "编码": "101121401"
          }, {
            "市名": "日照",
            "编码": "101121501"
          }, {
            "市名": "莱芜",
            "编码": "101121601"
          }, {
            "市名": "聊城",
            "编码": "101121701"
          }, {
            "市名": "青岛",
            "编码": "101120201"
          }, {
            "市名": "淄博",
            "编码": "101120301"
          }, {
            "市名": "德州",
            "编码": "101120401"
          }, {
            "市名": "烟台",
            "编码": "101120501"
          }, {
            "市名": "济宁",
            "编码": "101120701"
          }, {
            "市名": "泰安",
            "编码": "101120801"
          }
        ]
      }, {
        "省": "陕西省",
        "市": [
          {
            "市名": "西安",
            "编码": "101110101"
          }, {
            "市名": "延安",
            "编码": "101110300"
          }, {
            "市名": "榆林",
            "编码": "101110401"
          }, {
            "市名": "铜川",
            "编码": "101111001"
          }, {
            "市名": "商洛",
            "编码": "101110601"
          }, {
            "市名": "安康",
            "编码": "101110701"
          }, {
            "市名": "汉中",
            "编码": "101110801"
          }, {
            "市名": "宝鸡",
            "编码": "101110901"
          }, {
            "市名": "咸阳",
            "编码": "101110200"
          }, {
            "市名": "渭南",
            "编码": "101110501"
          }
        ]
      }, {
        "省": "山西",
        "市": [
          {
            "市名": "太原",
            "编码": "101100101"
          }, {
            "市名": "临汾",
            "编码": "101100701"
          }, {
            "市名": "运城",
            "编码": "101100801"
          }, {
            "市名": "朔州",
            "编码": "101100901"
          }, {
            "市名": "忻州",
            "编码": "101101001"
          }, {
            "市名": "长治",
            "编码": "101100501"
          }, {
            "市名": "大同",
            "编码": "101100201"
          }, {
            "市名": "阳泉",
            "编码": "101100301"
          }, {
            "市名": "晋中",
            "编码": "101100401"
          }, {
            "市名": "晋城",
            "编码": "101100601"
          }, {
            "市名": "吕梁",
            "编码": "101101100"
          }
        ]
      }, {
        "省": "新疆",
        "市": [
          {
            "市名": "乌鲁木齐",
            "编码": "101130101"
          }, {
            "市名": "石河子",
            "编码": "101130301"
          }, {
            "市名": "昌吉",
            "编码": "101130401"
          }, {
            "市名": "吐鲁番",
            "编码": "101130501"
          }, {
            "市名": "库尔勒",
            "编码": "101130601"
          }, {
            "市名": "阿拉尔",
            "编码": "101130701"
          }, {
            "市名": "阿克苏",
            "编码": "101130801"
          }, {
            "市名": "喀什",
            "编码": "101130901"
          }, {
            "市名": "伊宁",
            "编码": "101131001"
          }, {
            "市名": "塔城",
            "编码": "101131101"
          }, {
            "市名": "哈密",
            "编码": "101131201"
          }, {
            "市名": "和田",
            "编码": "101131301"
          }, {
            "市名": "阿勒泰",
            "编码": "101131401"
          }, {
            "市名": "阿图什",
            "编码": "101131501"
          }, {
            "市名": "博乐",
            "编码": "101131601"
          }, {
            "市名": "克拉玛依",
            "编码": "101130201"
          }
        ]
      }, {
        "省": "西藏",
        "市": [
          {
            "市名": "拉萨",
            "编码": "101140101"
          }, {
            "市名": "山南",
            "编码": "101140301"
          }, {
            "市名": "阿里",
            "编码": "101140701"
          }, {
            "市名": "昌都",
            "编码": "101140501"
          }, {
            "市名": "那曲",
            "编码": "101140601"
          }, {
            "市名": "日喀则",
            "编码": "101140201"
          }, {
            "市名": "林芝",
            "编码": "101140401"
          }
        ]
      }, {
        "省": "台湾",
        "市": [
          {
            "市名": "台北县",
            "编码": "101340101"
          }, {
            "市名": "高雄",
            "编码": "101340201"
          }, {
            "市名": "台中",
            "编码": "101340401"
          }
        ]
      }, {
        "省": "海南省",
        "市": [
          {
            "市名": "海口",
            "编码": "101310101"
          }, {
            "市名": "三亚",
            "编码": "101310201"
          }, {
            "市名": "东方",
            "编码": "101310202"
          }, {
            "市名": "临高",
            "编码": "101310203"
          }, {
            "市名": "澄迈",
            "编码": "101310204"
          }, {
            "市名": "儋州",
            "编码": "101310205"
          }, {
            "市名": "昌江",
            "编码": "101310206"
          }, {
            "市名": "白沙",
            "编码": "101310207"
          }, {
            "市名": "琼中",
            "编码": "101310208"
          }, {
            "市名": "定安",
            "编码": "101310209"
          }, {
            "市名": "屯昌",
            "编码": "101310210"
          }, {
            "市名": "琼海",
            "编码": "101310211"
          }, {
            "市名": "文昌",
            "编码": "101310212"
          }, {
            "市名": "保亭",
            "编码": "101310214"
          }, {
            "市名": "万宁",
            "编码": "101310215"
          }, {
            "市名": "陵水",
            "编码": "101310216"
          }, {
            "市名": "西沙",
            "编码": "101310217"
          }, {
            "市名": "南沙岛",
            "编码": "101310220"
          }, {
            "市名": "乐东",
            "编码": "101310221"
          }, {
            "市名": "五指山",
            "编码": "101310222"
          }, {
            "市名": "琼山",
            "编码": "101310102"
          }
        ]
      }, {
        "省": "湖南",
        "市": [
          {
            "市名": "长沙",
            "编码": "101250101"
          }, {
            "市名": "株洲",
            "编码": "101250301"
          }, {
            "市名": "衡阳",
            "编码": "101250401"
          }, {
            "市名": "郴州",
            "编码": "101250501"
          }, {
            "市名": "常德",
            "编码": "101250601"
          }, {
            "市名": "益阳",
            "编码": "101250700"
          }, {
            "市名": "娄底",
            "编码": "101250801"
          }, {
            "市名": "邵阳",
            "编码": "101250901"
          }, {
            "市名": "岳阳",
            "编码": "101251001"
          }, {
            "市名": "张家界",
            "编码": "101251101"
          }, {
            "市名": "怀化",
            "编码": "101251201"
          }, {
            "市名": "黔阳",
            "编码": "101251301"
          }, {
            "市名": "永州",
            "编码": "101251401"
          }, {
            "市名": "吉首",
            "编码": "101251501"
          }, {
            "市名": "湘潭",
            "编码": "101250201"
          }
        ]
      }, {
        "省": "江苏",
        "市": [
          {
            "市名": "南京",
            "编码": "101190101"
          }, {
            "市名": "镇江",
            "编码": "101190301"
          }, {
            "市名": "苏州",
            "编码": "101190401"
          }, {
            "市名": "南通",
            "编码": "101190501"
          }, {
            "市名": "扬州",
            "编码": "101190601"
          }, {
            "市名": "宿迁",
            "编码": "101191301"
          }, {
            "市名": "徐州",
            "编码": "101190801"
          }, {
            "市名": "淮安",
            "编码": "101190901"
          }, {
            "市名": "连云港",
            "编码": "101191001"
          }, {
            "市名": "常州",
            "编码": "101191101"
          }, {
            "市名": "泰州",
            "编码": "101191201"
          }, {
            "市名": "无锡",
            "编码": "101190201"
          }, {
            "市名": "盐城",
            "编码": "101190701"
          }
        ]
      }, {
        "省": "黑龙江",
        "市": [
          {
            "市名": "哈尔滨",
            "编码": "101050101"
          }, {
            "市名": "牡丹江",
            "编码": "101050301"
          }, {
            "市名": "佳木斯",
            "编码": "101050401"
          }, {
            "市名": "绥化",
            "编码": "101050501"
          }, {
            "市名": "黑河",
            "编码": "101050601"
          }, {
            "市名": "双鸭山",
            "编码": "101051301"
          }, {
            "市名": "伊春",
            "编码": "101050801"
          }, {
            "市名": "大庆",
            "编码": "101050901"
          }, {
            "市名": "七台河",
            "编码": "101051002"
          }, {
            "市名": "鸡西",
            "编码": "101051101"
          }, {
            "市名": "鹤岗",
            "编码": "101051201"
          }, {
            "市名": "齐齐哈尔",
            "编码": "101050201"
          }, {
            "市名": "大兴安岭",
            "编码": "101050701"
          }
        ]
      }, {
        "省": "吉林",
        "市": [
          {
            "市名": "长春",
            "编码": "101060101"
          }, {
            "市名": "延吉",
            "编码": "101060301"
          }, {
            "市名": "四平",
            "编码": "101060401"
          }, {
            "市名": "白山",
            "编码": "101060901"
          }, {
            "市名": "白城",
            "编码": "101060601"
          }, {
            "市名": "辽源",
            "编码": "101060701"
          }, {
            "市名": "松原",
            "编码": "101060801"
          }, {
            "市名": "吉林",
            "编码": "101060201"
          }, {
            "市名": "通化",
            "编码": "101060501"
          }
        ]
      }, {
        "省": "辽宁",
        "市": [
          {
            "市名": "沈阳",
            "编码": "101070101"
          }, {
            "市名": "鞍山",
            "编码": "101070301"
          }, {
            "市名": "抚顺",
            "编码": "101070401"
          }, {
            "市名": "本溪",
            "编码": "101070501"
          }, {
            "市名": "丹东",
            "编码": "101070601"
          }, {
            "市名": "葫芦岛",
            "编码": "101071401"
          }, {
            "市名": "营口",
            "编码": "101070801"
          }, {
            "市名": "阜新",
            "编码": "101070901"
          }, {
            "市名": "辽阳",
            "编码": "101071001"
          }, {
            "市名": "铁岭",
            "编码": "101071101"
          }, {
            "市名": "朝阳",
            "编码": "101071201"
          }, {
            "市名": "盘锦",
            "编码": "101071301"
          }, {
            "市名": "大连",
            "编码": "101070201"
          }, {
            "市名": "锦州",
            "编码": "101070701"
          }
        ]
      }
    ]
  };

  Weather = (function() {
    function Weather() {
      this.weather_more_pic_src = __bind(this.weather_more_pic_src, this);
      this.weathergui_update = __bind(this.weathergui_update, this);
      this.weathergui_init = __bind(this.weathergui_init, this);
      this.get_client_cityid = __bind(this.get_client_cityid, this);
      this.ajax = __bind(this.ajax, this);
      this.distadd = __bind(this.distadd, this);
      this.cityadd = __bind(this.cityadd, this);
      this.read_data_from_json = __bind(this.read_data_from_json, this);
      var about, city, city_and_date, feedback, img_more_url_init, img_now_url_init, left_div, refresh_context, right_div, temperature_now, weather_close, week_init,
        _this = this;

      this.img_url_first = "desktop_plugin/weather/img/";
      week_init = "星期日";
      img_now_url_init = this.img_url_first + "48/T" + "0晴" + ".png";
      img_more_url_init = this.img_url_first + "24/T" + "0晴" + ".png";
      this.id = "weather";
      this.pos = {
        x: 10,
        y: 1,
        width: 3,
        height: 1
      };
      this.element = document.createElement('div');
      this.element.setAttribute('class', "Weather");
      this.element.draggable = true;
      this.weathergui_init();
      left_div = create_element("div", "left_div", this.element);
      this.weather_now_pic = create_img("weather_now_pic", img_now_url_init, left_div);
      right_div = create_element("div", "right_div", this.element);
      temperature_now = create_element("div", "temperature_now", right_div);
      this.temperature_now_minus = create_element("div", "temperature_now_minus", temperature_now);
      this.temperature_now_minus.textContent = "-";
      this.temperature_now_number = create_element("div", "temperature_now_number", temperature_now);
      this.temperature_now_number.textContent = "3°";
      city_and_date = create_element("div", "city_and_date", right_div);
      city = create_element("div", "city", city_and_date);
      this.city_now = create_element("div", "city_now", city);
      this.city_now.textContent = "请选择城市";
      this.more_city_img = create_img("more_city_img", this.img_url_first + "ar.png", city);
      this.more_city_menu = create_element("div", "more_city_menu", this.element);
      this.more_city_menu.style.display = "none";
      this.date = create_element("div", "date", city_and_date);
      this.date.textContent = "正在加载中..." + " " + "...";
      this.more_weather_menu = create_element("div", "more_weather_menu", this.element);
      this.more_weather_menu.style.display = "none";
      this.first_day_weather_data = create_element("div", "first_day_weather_data", this.more_weather_menu);
      this.week1 = create_element("a", "week1", this.first_day_weather_data);
      this.week1.textContent = week_init;
      this.pic1 = create_img("pic1", img_more_url_init, this.first_day_weather_data);
      this.temperature1 = create_element("a", "temperature1", this.first_day_weather_data);
      this.temperature1.textContent = "22℃~10℃";
      this.second_day_weather_data = create_element("div", "second_day_weather_data", this.more_weather_menu);
      this.week2 = create_element("a", "week2", this.second_day_weather_data);
      this.week2.textContent = week_init;
      this.pic2 = create_img("pic2", img_more_url_init, this.second_day_weather_data);
      this.temperature2 = create_element("a", "temperature2", this.second_day_weather_data);
      this.temperature2.textContent = "22℃~10℃";
      this.third_day_weather_data = create_element("div", "third_day_weather_data", this.more_weather_menu);
      this.week3 = create_element("a", "week3", this.third_day_weather_data);
      this.week3.textContent = week_init;
      this.pic3 = create_img("pic3", img_more_url_init, this.third_day_weather_data);
      this.temperature3 = create_element("a", "temperature3", this.third_day_weather_data);
      this.temperature3.textContent = "22℃~10℃";
      this.fourth_day_weather_data = create_element("div", "fourth_day_weather_data", this.more_weather_menu);
      this.week4 = create_element("a", "week4", this.fourth_day_weather_data);
      this.week4.textContent = week_init;
      this.pic4 = create_img("pic4", img_more_url_init, this.fourth_day_weather_data);
      this.temperature4 = create_element("a", "temperature4", this.fourth_day_weather_data);
      this.temperature4.textContent = "22℃~10℃";
      this.fifth_day_weather_data = create_element("div", "fifth_day_weather_data", this.more_weather_menu);
      this.week5 = create_element("a", "week5", this.fifth_day_weather_data);
      this.week5.textContent = week_init;
      this.pic5 = create_img("pic5", img_more_url_init, this.fifth_day_weather_data);
      this.temperature5 = create_element("a", "temperature5", this.fifth_day_weather_data);
      this.temperature5.textContent = "22℃~10℃";
      this.sixth_day_weather_data = create_element("div", "sixth_day_weather_data", this.more_weather_menu);
      this.week6 = create_element("a", "week6", this.sixth_day_weather_data);
      this.week6.textContent = week_init;
      this.pic6 = create_img("pic6", img_more_url_init, this.sixth_day_weather_data);
      this.temperature6 = create_element("a", "temperature6", this.sixth_day_weather_data);
      this.temperature6.textContent = "22℃~10℃";
      this.refresh = create_img("refresh", this.img_url_first + "refresh.png", this.element);
      this.chooseprov = create_element("select", "chooseprov", this.more_city_menu);
      this.choosecity = create_element("select", "choosecity", this.more_city_menu);
      this.choosedist = create_element("select", "choosedist", this.more_city_menu);
      this.contextmenu = create_element("div", "contextmenu", this.element);
      this.contextmenu.style.display = "none";
      weather_close = create_element("div", "weather_close", this.contextmenu);
      refresh_context = create_element("div", "refresh_context", this.contextmenu);
      feedback = create_element("div", "feedback", this.contextmenu);
      about = create_element("div", "about", this.contextmenu);
      weather_close.innerText = "关闭";
      refresh_context.innerText = "刷新";
      feedback.innerText = "反馈";
      about.innerText = "关于";
      this.date.addEventListener("click", function() {
        if (_this.more_weather_menu.style.display === "none") {
          _this.more_weather_menu.style.display = "block";
          _this.more_city_menu.style.display = "none";
          return _this.more_weather_menu.style.zIndex = "65535";
        } else {
          _this.more_weather_menu.style.display = "none";
          _this.more_city_menu.style.display = "none";
          return _this.more_weather_menu.style.zIndex = "0";
        }
      });
      city.addEventListener("click", function() {
        var cityinit, distinit, i, provinit;

        if (_this.more_city_menu.style.display === "none") {
          _this.more_city_menu.style.display = "block";
          _this.more_weather_menu.style.display = "none";
          _this.more_city_menu.style.zIndex = "65535";
          _this.display_city_menu_id = setTimeout(function() {
            return _this.more_city_menu.style.display = "none";
          }, 4000);
        } else {
          _this.more_city_menu.style.display = "none";
          _this.more_weather_menu.style.display = "none";
          _this.more_city_menu.style.zIndex = "0";
        }
        _this.chooseprov.options.length = 0;
        provinit = create_element("option", "provinit", _this.chooseprov);
        provinit.innerText = "--省--";
        provinit.selected = "true";
        i = 0;
        while (i < cities.length) {
          _this.chooseprov.options.add(new Option(cities[i].name, cities[i++].id));
        }
        _this.chooseprov.size = (_this.chooseprov.options.length < 13 ? _this.chooseprov.options.length : 13);
        echo("@chooseprov.options.length:" + _this.chooseprov.options.length);
        _this.choosecity.size = 1;
        _this.choosecity.options.length = 0;
        cityinit = create_element("option", "cityinit", _this.choosecity);
        cityinit.innerText = "--市--";
        cityinit.selected = "true";
        _this.choosedist.size = 1;
        _this.choosedist.options.length = 0;
        distinit = create_element("option", "distinit", _this.choosedist);
        distinit.innerText = "--县--";
        return distinit.selected = "true";
      });
      this.more_city_menu.addEventListener("click", function() {
        echo("@more_city_menu click");
        return clearTimeout(_this.display_city_menu_id);
      });
      this.chooseprov.addEventListener("change", function() {
        var data, provIndex, provvalue;

        provIndex = _this.chooseprov.selectedIndex;
        echo("provIndex:" + provIndex);
        provvalue = _this.chooseprov.options[provIndex].value;
        echo("provvalue:" + provvalue);
        if (provvalue !== "--省--") {
          return data = _this.read_data_from_json(provvalue);
        }
      });
      this.element.addEventListener("click", function() {
        return _this.contextmenu.style.display = "none";
      });
      this.element.addEventListener("contextmenu", function(evt) {
        var bottom_distance;

        _this.more_weather_menu.style.display = "none";
        _this.more_city_menu.style.display = "none";
        if (_this.contextmenu.style.display === "none") {
          bottom_distance = window.screen.availHeight - _this.element.getBoundingClientRect().bottom;
          echo("bottom_distance:( if it > 200 then show up)" + bottom_distance);
          if (bottom_distance < 200) {
            _this.contextmenu.style.top = 0;
          }
          _this.contextmenu.style.display = "block";
          return _this.contextmenu.style.zIndex = "65535";
        } else {
          return _this.contextmenu.style.display = "none";
        }
      });
      weather_close.addEventListener("click", function() {
        return _this.element.style.display = "none";
      });
      refresh_context.addEventListener("click", function() {
        _this.refresh.style.backgroundColor = "gray";
        return _this.weathergui_update(_this.cityid);
      });
      feedback.addEventListener("click", function() {
        var feedbackmsg;

        feedbackmsg = prompt("亲～谢谢您的反馈～～", "");
        if (feedbackmsg !== null) {
          return echo("feedbackmsg" + feedbackmsg);
        }
      });
      about.addEventListener("click", function() {
        var str;

        str = "深度天气插件1.0.0" + "\n" + "Author:bluth" + "\n" + "Copyright (c) 2011 ~ 2012 Deepin, Inc." + "\n" + "www.linuxdeepin.com";
        return alert(str);
      });
      this.refresh.addEventListener("click", function() {
        _this.refresh.style.backgroundColor = "gray";
        return _this.weathergui_update(_this.cityid);
      });
    }

    Weather.prototype.get_id = function() {
      return this.id;
    };

    Weather.prototype.set_id = function(id) {
      return this.id = id;
    };

    Weather.prototype.get_pos = function() {
      return this.pos;
    };

    Weather.prototype.set_pos = function(pos) {
      return this.pos = pos;
    };

    Weather.prototype.read_data_from_json = function(id) {
      var url, xhr,
        _this = this;

      xhr = new XMLHttpRequest();
      url = "desktop_plugin/weather/city/" + id + ".json";
      xhr.open("GET", url, true);
      xhr.send(null);
      return xhr.onreadystatechange = function() {
        var data;

        if (xhr.readyState === 4) {
          data = JSON.parse(xhr.responseText);
          return _this.cityadd(data[id].data);
        }
      };
    };

    Weather.prototype.cityadd = function(data) {
      var i,
        _this = this;

      this.choosecity.options.length = 1;
      for (i in data) {
        this.choosecity.options.add(new Option(data[i].name, i));
      }
      this.choosecity.size = (this.choosecity.options.length < 13 ? this.choosecity.options.length : 13);
      echo("@choosecity.options.length:" + this.choosecity.options.length);
      echo("@choosecity.size:" + this.choosecity.size);
      return this.choosecity.onchange = function() {
        var cityIndex, cityvalue;

        cityIndex = _this.choosecity.selectedIndex;
        echo("cityIndex:" + cityIndex);
        if (cityIndex === -1) {
          return _this.choosecity.options.remove(cityIndex);
        } else {
          cityvalue = _this.choosecity.options[cityIndex].value;
          echo("cityvalue:" + cityvalue);
          if (cityvalue !== "--市--") {
            return _this.distadd(data[cityvalue].data);
          }
        }
      };
    };

    Weather.prototype.distadd = function(data) {
      var i,
        _this = this;

      this.choosedist.options.length = 1;
      for (i in data) {
        this.choosedist.options.add(new Option(data[i].name, i));
      }
      this.choosedist.size = (this.choosedist.options.length < 13 ? this.choosedist.options.length : 13);
      echo("@choosedist.options.length:" + this.choosedist.options.length);
      echo("@choosedist.size:" + this.choosedist.size);
      return this.choosedist.onchange = function() {
        var distIndex, distvalue;

        distIndex = _this.choosedist.selectedIndex;
        echo("distIndex:" + distIndex);
        if (distIndex === -1) {
          return _this.choosedist.options.remove(distIndex);
        } else {
          distvalue = _this.choosedist.options[distIndex].value;
          echo("distvalue:" + distvalue);
          if (distvalue !== "--县--") {
            _this.cityid = data[distvalue].data;
            echo("@cityid " + _this.cityid);
            _this.more_city_menu.style.display = "none";
            return setInterval(_this.weathergui_update(_this.cityid), 1800000);
          }
        }
      };
    };

    Weather.prototype.ajax = function(url, method, callback, asyn) {
      var xhr,
        _this = this;

      if (asyn == null) {
        asyn = true;
      }
      xhr = new XMLHttpRequest();
      xhr.open(method, url, asyn);
      xhr.send(null);
      return xhr.onreadystatechange = function() {
        if (xhr.readyState === 4 && xhr.status === 200) {
          return typeof callback === "function" ? callback(xhr) : void 0;
        } else if (xhr.status !== 200) {
          return echo("XMLHttpRequest can't receive data.");
        }
      };
    };

    Weather.prototype.get_client_cityid = function() {
      var ip_url,
        _this = this;

      ip_url = "http://int.dpool.sina.com.cn/iplookup/iplookup.php";
      return this.ajax(ip_url, "GET", function(xhr) {
        var client_ip, ip, ip_url2, str;

        localStorage.setItem(client_ip, xhr.responseText);
        client_ip = localStorage.getItem(client_ip);
        str = client_ip.toString();
        if (str[0] === '1') {
          ip = str.slice(2, 12);
          echo("ip start :" + ip);
          ip_url2 = ip_url + "?format=js&ip=" + ip;
          return _this.ajax(ip_url2, "GET", function(xhr) {
            var ci, client_ip_city, provin, remote_ip_info, _results;

            client_ip_city = xhr.responseText;
            remote_ip_info = client_ip_city.slice(21, client_ip_city.length);
            localStorage.setItem(remote_ip_info, remote_ip_info);
            remote_ip_info = JSON.parse(localStorage.getItem(remote_ip_info));
            if (remote_ip_info.ret === 1) {
              echo("remote_ip_info.province:" + remote_ip_info.province);
              echo("remote_ip_info.city:" + remote_ip_info.city);
              _results = [];
              for (provin in allname.data) {
                if (allname.data[provin].省 === remote_ip_info.province) {
                  _results.push((function() {
                    var _results1;

                    _results1 = [];
                    for (ci in allname.data[provin].市) {
                      if (allname.data[provin].市[ci].市名 === remote_ip_info.city) {
                        echo(allname.data[provin].市[ci].编码);
                        this.cityid = allname.data[provin].市[ci].编码;
                        _results1.push(this.weathergui_update(this.cityid));
                      } else {
                        _results1.push(void 0);
                      }
                    }
                    return _results1;
                  }).call(_this));
                } else {
                  _results.push(void 0);
                }
              }
              return _results;
            } else {
              return echo("sina 没有找到匹配的 IP 地址信息！");
            }
          });
        } else {
          return echo("sina iplookup first lose");
        }
      });
    };

    Weather.prototype.weathergui_init = function() {
      var loader;

      loader = new Loader;
      loader.addcss('desktop_plugin/weather/weather.css').load();
      return this.get_client_cityid();
    };

    Weather.prototype.weathergui_update = function(cityid) {
      var now_weather_url, weather_url,
        _this = this;

      localStorage.setItem(cityid, cityid);
      cityid = localStorage.getItem(cityid);
      now_weather_url = "http://www.weather.com.cn/data/sk/" + cityid + ".html";
      weather_url = "http://m.weather.com.cn/data/" + cityid + ".html";
      this.ajax(now_weather_url, "GET", function(xhr) {
        var temp_now, weather_data_now;

        localStorage.setItem(weather_data_now, xhr.responseText);
        weather_data_now = JSON.parse(localStorage.getItem(weather_data_now));
        temp_now = weather_data_now.weatherinfo.temp;
        _this.time_update = weather_data_now.weatherinfo.time;
        echo("temp_now:" + temp_now);
        echo("@time_update:" + _this.time_update);
        _this.city_now.textContent = weather_data_now.weatherinfo.city;
        if (temp_now < -10) {
          _this.temperature_now_minus.style.opacity = 0.8;
          return _this.temperature_now_number.textContent = -temp_now + "°";
        } else {
          _this.temperature_now_minus.style.opacity = 0;
          return _this.temperature_now_number.textContent = temp_now + "°";
        }
      });
      return this.ajax(weather_url, "GET", function(xhr) {
        var i_week, str_data, weather_data, week_n, week_name;

        localStorage.setItem(weather_data, xhr.responseText);
        weather_data = JSON.parse(localStorage.getItem(weather_data));
        _this.weather_data = weather_data;
        week_name = ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"];
        i_week = 0;
        while (i_week < week_name.length) {
          if (weather_data.weatherinfo.week === week_name[i_week]) {
            break;
          }
          i_week++;
        }
        week_n = i_week;
        str_data = weather_data.weatherinfo.date_y;
        _this.date.textContent = str_data.substring(0, str_data.indexOf("年")) + "." + str_data.substring(str_data.indexOf("年") + 1, str_data.indexOf("月")) + "." + str_data.substring(str_data.indexOf("月") + 1, str_data.indexOf("日")) + weather_data.weatherinfo.week;
        _this.weather_now_pic.src = _this.img_url_first + "48/T" + weather_data.weatherinfo.img_single + weather_data.weatherinfo.img_title_single + ".png";
        _this.week1.textContent = week_name[week_n % 7];
        _this.pic1.src = _this.weather_more_pic_src(1);
        _this.temperature1.textContent = weather_data.weatherinfo.temp1;
        _this.week2.textContent = week_name[(week_n + 1) % 7];
        _this.pic2.src = _this.weather_more_pic_src(2);
        _this.temperature2.textContent = weather_data.weatherinfo.temp2;
        _this.week3.textContent = week_name[(week_n + 2) % 7];
        _this.pic3.src = _this.weather_more_pic_src(3);
        _this.temperature3.textContent = weather_data.weatherinfo.temp3;
        _this.week4.textContent = week_name[(week_n + 3) % 7];
        _this.pic4.src = _this.weather_more_pic_src(4);
        _this.temperature4.textContent = weather_data.weatherinfo.temp4;
        _this.week5.textContent = week_name[(week_n + 4) % 7];
        _this.pic5.src = _this.weather_more_pic_src(5);
        _this.temperature5.textContent = weather_data.weatherinfo.temp5;
        _this.week6.textContent = week_name[(week_n + 5) % 7];
        _this.pic6.src = _this.weather_more_pic_src(6);
        _this.temperature6.textContent = weather_data.weatherinfo.temp6;
        return _this.refresh.style.backgroundColor = null;
      });
    };

    Weather.prototype.weather_more_pic_src = function(i) {
      var hours_now, img_behind, img_front, src, time, weather_data;

      i = i * 2 - 1;
      weather_data = this.weather_data;
      src = null;
      time = new Date();
      hours_now = time.getHours();
      img_front = [weather_data.weatherinfo.img_single, weather_data.weatherinfo.img1, weather_data.weatherinfo.img2, weather_data.weatherinfo.img3, weather_data.weatherinfo.img4, weather_data.weatherinfo.img5, weather_data.weatherinfo.img6, weather_data.weatherinfo.img7, weather_data.weatherinfo.img8, weather_data.weatherinfo.img9, weather_data.weatherinfo.img10, weather_data.weatherinfo.img11, weather_data.weatherinfo.img12];
      img_behind = [weather_data.weatherinfo.img_title_single, weather_data.weatherinfo.img_title1, weather_data.weatherinfo.img_title2, weather_data.weatherinfo.img_title3, weather_data.weatherinfo.img_title4, weather_data.weatherinfo.img_title5, weather_data.weatherinfo.img_title6, weather_data.weatherinfo.img_title7, weather_data.weatherinfo.img_title8, weather_data.weatherinfo.img_title9, weather_data.weatherinfo.img_title10, weather_data.weatherinfo.img_title11, weather_data.weatherinfo.img_title12];
      if (img_front[i + 1] === "99") {
        img_front[i + 1] = img_front[i];
      }
      if (hours_now < 12) {
        src = this.img_url_first + "24/T" + img_front[i] + img_behind[i] + ".png";
      } else {
        src = this.img_url_first + "24/T" + img_front[i + 1] + img_behind[i + 1] + ".png";
      }
      return src;
    };

    return Weather;

  })();

  window.desktop_plugin = [];

  plugins = window.desktop_plugin;

  weather = new Weather;

  plugins.push(weather);

}).call(this);
